# Сервис формирования отчётов #
----
## Стэк ##
**Frontend**
1. HTMX
2. JS
3. Bootstrap
4. Stimulsoft

**API**
1. C#
2. EntityFramework

**БД**
1. MySQL
----
## Основные компоненты ##
### Frontend ###
+ ndex.html - подключение скриптов (в.т.ч Stimulsoft), разметка *SPA* с использованием htmx функционала для отправки запросов и направления полученных данных.
+ index.js - методы обработки событий dom обновлений, формирования и отображения на странице соответствующего отчёта.
### API ###
+ ErrorController.cs - контроллер, содержащий post-запросы получения статистики отправленных пользователями ошибок в ходе эксплуатации программы:
    1. **GetError**([FromBody] JsonElement requestBody) - входной параметр десериализуется к классу *ErrorGetRequest* и используется для запроса к БД с целью получения ошибки с соответствующим GUID. Ответ возвращаем в виде класса *ErrorResponse*;
    2. **GetListError**([FromBody] JsonElement requestBody) - запрос для получения списка ошибок в указанный период, а в случае, если не указан, то за все время. JsonElement десериализуется в объект класса *ErrorsGetRequest*, откуда получаем даты для периода. Данные полученные из БД приводим к классу *ErrorResponse* для того, чтобы не все данные возвращались на front;
    3. **GetListErrorPieChart**([FromBody] JsonElement requestBody) - запрос для получения данных конкретно по версиям для круговой диаграммы. Данная диаграмма позволит проанализировать количество ошибок в каждой версии. JsonElement десериализуется в объект класса *ErrorsGetRequest*, данные из БД приводим к классу *ErrorPieChartResponse* и отправляем.
+ UserController.cs - контроллер, содержащий post-запросы получения статистики пользователей, лицензий и общей статочстики по параметрам установок, активных устройств и продаж:
    1. **GetAuthUsersStats**() - возвращает ключевые данные всех авторизированных пользователей (задел для получения статистики для целефок компаний);
    2. **GetFreeTriaLicenses**() - возвращает данные лицензий, находящихся в состоянии пробного периода;
    3. **GetMainStats**() - возвращает список основных данных по кол-ву и состоянию лицензий, кол-ву установок в целевых компаниял, активациям и продажам ключей;
    4. **GetPeriodMainStats**([FromBody] JsonElement request) - аналогичен предыдущему, возвращает срез данных в указанном временном промежутке, на вход получает json с указанием дат начала и конца исследуемого периода.
### БД ###
База данных представляет собой срез тестовой БД дочернего проекта.

----
## Принцип работы ##
SPA имеет три таба, отвечающие за формирование тестового отчёта, отчёта по клиентам и отчёта по ошибкам соответственно.
Кнопки, расположенные на странице, содержат htmx-синтаксис: *hx-post*, *hx-trigger*, *hx-target* и *hx-swap*.
Нажатие кнопки инициирует вызов соответствующего запроса с последующим получением данных в формате *JSON* и срабатывание метода обработки данных, навешенного на событие *DOMContentLoaded*.
Главный метод сверяет *id* вызова, запуская цепочку обработки полученных данных, загрузку шаблона трабуемого отчёта, установку данных и рендер отчёта.
