/*! For license information please see bundle.js.LICENSE.txt */
(()=>{function t(){var r,n,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function s(t,o,a,i){var s=o&&o.prototype instanceof u?o:u,l=Object.create(s.prototype);return e(l,"_invoke",function(t,e,o){var a,i,s,u=0,l=o||[],p=!1,f={p:0,n:0,v:r,a:d,f:d.bind(r,4),d:function(t,e){return a=t,i=0,s=r,f.n=e,c}};function d(t,e){for(i=t,s=e,n=0;!p&&u&&!o&&n<l.length;n++){var o,a=l[n],d=f.p,m=a[2];t>3?(o=m===e)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=r):a[0]<=d&&((o=t<2&&d<a[1])?(i=0,f.v=e,f.n=a[1]):d<m&&(o=t<3||a[0]>e||e>m)&&(a[4]=t,a[5]=e,f.n=m,i=0))}if(o||t>1)return c;throw p=!0,e}return function(o,l,m){if(u>1)throw TypeError("Generator is already running");for(p&&1===l&&d(l,m),i=l,s=m;(n=i<2?r:s)||!p;){a||(i?i<3?(i>1&&(f.n=-1),d(i,s)):f.n=s:f.v=s);try{if(u=2,a){if(i||(o="next"),n=a[o]){if(!(n=n.call(a,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,i<2&&(i=0)}else 1===i&&(n=a.return)&&n.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=r}else if((n=(p=f.n<0)?s:t.call(e,f))!==c)break}catch(t){a=r,i=1,s=t}finally{u=1}}return{value:n,done:p}}}(t,a,i),!0),l}var c={};function u(){}function l(){}function p(){}n=Object.getPrototypeOf;var f=[][a]?n(n([][a]())):(e(n={},a,function(){return this}),n),d=p.prototype=u.prototype=Object.create(f);function m(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,e(t,i,"GeneratorFunction")),t.prototype=Object.create(d),t}return l.prototype=p,e(d,"constructor",p),e(p,"constructor",l),l.displayName="GeneratorFunction",e(p,i,"GeneratorFunction"),e(d),e(d,i,"Generator"),e(d,a,function(){return this}),e(d,"toString",function(){return"[object Generator]"}),(t=function(){return{w:s,m}})()}function e(t,r,n,o){var a=Object.defineProperty;try{a({},"",{})}catch(t){a=0}e=function(t,r,n,o){function i(r,n){e(t,r,function(t){return this._invoke(r,n,t)})}r?a?a(t,r,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[r]=n:(i("next",0),i("throw",1),i("return",2))},e(t,r,n,o)}function r(t,e,r,n,o,a,i){try{var s=t[a](i),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}function n(t){return function(){var e=this,n=arguments;return new Promise(function(o,a){var i=t.apply(e,n);function s(t){r(i,o,a,s,c,"next",t)}function c(t){r(i,o,a,s,c,"throw",t)}s(void 0)})}}var o=null,a="http://127.0.0.1:5000";function i(t,e){return s.apply(this,arguments)}function s(){return(s=n(t().m(function e(r,n){var a,i,s,c,u,l,p,f;return t().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,console.log(n),console.log(r),a=new Stimulsoft.Report.StiReport,i=document.querySelector("#reportTabs .nav-link.active"),"tests-tab"===(s=i?i.id:"")?reportFile="./reports/Report.mrt":"users-tab"===s?reportFile="./reports/main-stat-report.mrt":"errors-tab"!==s&&"reportResult"!==n||(reportFile="./reports/Report2.mrt"),a.loadFile(reportFile),c="report-data",(u=new Stimulsoft.System.Data.DataSet(c)).readJson(JSON.stringify(r)),a.dictionary.databases.clear(),a.regData(c,c,u),t.n=1,a.renderAsync();case 1:o=a,l=new Stimulsoft.Viewer.StiViewerOptions,(p=new Stimulsoft.Viewer.StiViewer(l,"StiViewer",!1)).report=a,document.getElementById("reportResult").innerHTML="",p.renderHtml("reportResult"),t.n=3;break;case 2:t.p=2,f=t.v,console.error(f);case 3:return t.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function c(t,e){return u.apply(this,arguments)}function u(){return(u=n(t().m(function e(r,n){var o,s,c,u,l,p,f;return t().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,console.log(r),document.getElementById("reportResult").innerHTML='<div class="justify-content-center align-items-center d-flex"><div class="spinner-border" role="status"></div></div>',o=new Date(r+"-01").toISOString(),(s=new Date(n+"-01")).setMonth(s.getMonth()+1),s.setDate(s.getDate()-1),c=s.toISOString(),u={},t.n=1,fetch(a+"/error/get_list_errors_pie",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({StartDate:o,EndDate:c})});case 1:if((l=t.v).ok){t.n=2;break}throw new Error("Ошибка при получении pie данных: ".concat(l.status));case 2:return t.n=3,l.json();case 3:return u.pie_char=t.v,t.n=4,fetch(a+"/error/get_list_error",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({StartDate:o,EndDate:c})});case 4:if((p=t.v).ok){t.n=5;break}throw new Error("Ошибка при получении списка ошибок: ".concat(p.status));case 5:return t.n=6,p.json();case 6:return u.errors=t.v,t.n=7,i(u,"reportResult");case 7:t.n=9;break;case 8:t.p=8,f=t.v,console.error("Ошибка при загрузке отчета по ошибкам:",f),document.getElementById("reportResult").innerHTML='<div class="alert alert-danger">Ошибка загрузки отчета: '.concat(f.message,"</div>");case 9:return t.a(2)}},e,null,[[0,8]])}))).apply(this,arguments)}function l(t,e){var r=String(e+1).padStart(2,"0");return"".concat(t,"-").concat(r)}document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll('#reportTabs button[data-bs-toggle="tab"]').forEach(function(t){t.addEventListener("shown.bs.tab",function(t){var e=t.target.getAttribute("data-bs-target").substring(1);if(document.getElementById("reportResult").innerHTML='<div class="loading"><div class="spinner-border" role="status"></div></div>',"tests"===e)document.body.dispatchEvent(new CustomEvent("load-tests-report"));else if("users"===e)document.body.dispatchEvent(new CustomEvent("load-users-report"));else if("errors"===e){var r=new Date,n=r.getFullYear(),o=r.getMonth(),a=o-1,i=n;a<0&&(a=11,i=n-1),c(l(i,a),l(n,o))}})}),document.body.dispatchEvent(new CustomEvent("load-users-report"))}),document.getElementById("errorsForm").addEventListener("submit",function(){var e=n(t().m(function e(r){var n,o,a;return t().w(function(t){for(;;)switch(t.n){case 0:if(r.preventDefault(),n=new FormData(this),o=n.get("monthFrom"),a=n.get("monthTo"),o&&a){t.n=1;break}return alert("Пожалуйста, выберите оба месяца."),t.a(2);case 1:return t.n=2,c(o,a);case 2:return t.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()),document.body.addEventListener("htmx:afterOnLoad",function(){var e=n(t().m(function e(r){var n,o;return t().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,n=JSON.parse(r.detail.xhr.responseText),t.n=1,i(n,"reportResult");case 1:t.n=3;break;case 2:t.p=2,o=t.v,console.warn(o);case 3:return t.a(2)}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}()),window.exportToHTML=function(){o&&o.exportDocumentAsync(function(t){Stimulsoft.System.StiObject.saveAs(t,"report.html","text/html;charset=utf-8")},Stimulsoft.Report.StiExportFormat.Html)},window.exportToPDF=function(){o&&o.exportDocumentAsync(function(t){Stimulsoft.System.StiObject.saveAs(t,"report.pdf","application/pdf")},Stimulsoft.Report.StiExportFormat.Pdf)}})();